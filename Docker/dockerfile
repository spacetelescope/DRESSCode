FROM dresscodeswift/heasoft-caldb-wcstools:latest

COPY requirements.txt .

SHELL ["/bin/bash", "-c"]

RUN \
    python3 -m venv venv \
    && source /home/heasoft/venv/bin/activate \
    && /bin/echo 'source /home/heasoft/venv/bin/activate' >> /home/heasoft/.profile \
    && /bin/echo 'source /home/heasoft/venv/bin/activate' >> /home/heasoft/.bashrc \
    && /bin/echo 'source /home/heasoft/venv/bin/activate' >> /home/heasoft/.cshrc \
    && python -m pip install pip -U \
    && python -m pip install --no-cache-dir wheel numpy \
    && python -m pip install --no-cache-dir -r requirements.txt

COPY --chown=heasoft . /opt/dresscode

WORKDIR /opt/dresscode

RUN \
    # if running as another user, need to source the venv
    source /home/heasoft/venv/bin/activate \
    # installs the package & scripts
    && python -m pip install -e .
